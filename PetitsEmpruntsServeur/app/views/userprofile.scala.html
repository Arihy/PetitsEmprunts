@(borrows: List[Borrow], borrowForm: Form[Borrow])

@import helper._

@main(session.get("nickname")) {
	<h1>Bonjour <a href="@routes.UserProfile.index()">@session.get("nickname")</a></h1>
	
	<h2>Déclarer un nouvel emprunt : </h2>
	@form(routes.UserProfile.newBorrow()) {
		 @select(borrowForm("borrower.id"), 
        		options(User.options()),
        		'_default -> "--- Choose a user ---",
                	'_label -> "Qui emprunte ?"
        		)
		@inputText(borrowForm("thing.label"), '_label -> "Quoi ?")
		@select(borrowForm("owner.id"), 
        		options(User.options()),
        		'_default -> "--- Choose a user ---",
                	'_label -> "A qui ?"
        		)
	<input type="submit" value="Create">
	}
	
	Vous cherchez quelqu'un qui n'est pas dans la liste ? <a href="@routes.UserProfile.nonactiveuserDeclaration()">Cliquez-ici</a>

	<div class="hero-unit">
	@if(borrows.size()>0) {
		<h2>Récapitulatif de vos emprunts :</h2>
		<ul>
		@for((borrow, i) <- borrows.zipWithIndex) {
			@if(i%2 == 0) {
				<li class="alt block">
			} else {
				<li class="block">
			}
			@borrow.getStartingDate() : @borrow.getBorrower().getNickname() a emprunté @borrow.getExemplary().getThing().getLabel() à @borrow.getExemplary().getOwner().getNickname()
			@if(borrow.getClosingDate() == null) {
				<button class="btn-close-borrow" id="btn-close-borrow-@borrow.getId()">Close !</button>
			} else {
				rendu le @borrow.getClosingDate()		
			}
		}
		</ul>
	} else {
	<h2>Aucun emprunt en cours.</h2>
	}

	</div>
}

<script type="text/javascript">
$(document).ready(function($){

        $("body").ajaxError(function(event, jqXHR, ajaxSettings, thrownError){
            alert("ERROR : " + thrownError);
          //  location.reload();
        });

        $close = $(".btn-close-borrow");

	$close.click(function(event) {
		$this = $(this);
            	var idBorrow = $this.attr("id").substring(17);
		alert("clicked on a close btn! : " + idBorrow);
		$.ajax({
	                type: 'POST',
	                url: "@routes.UserProfile.closeBorrow()",
			contentType: "application/json; charset=UTF-8",
         		data: JSON.stringify({"idBorrow":idBorrow }),
                	success: function(){
                    		alert("emprunt terminé");
				location.reload();
                			}
            		})


	})
});
</script>
